<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Ethicode | íƒì • ìê²© ì‹œí—˜</title>
  <link rel="stylesheet" href="quiz_style.css" />
  <link rel="stylesheet" href="quiz_style_additional.css" />
  <link rel="icon" href="favicon.png" type="image/png">
</head>
<body>
  <div class="container">
    <header>
      <img src="detective-icon.png" alt="íƒì • ì•„ì´ì½˜" class="icon">
      <h1><span class="highlight">Ethicode</span> íƒì •ë‹˜ì˜ ì´ë¦„ì€...</h1>
    </header>

    <!-- ì‚¬ìš©ì ì •ë³´ ì…ë ¥ í¼ -->
    <div id="user-form" class="form-container">
      <p class="intro">
        í€´ì¦ˆë¥¼ ì‹œì‘í•˜ê¸° ì „ì— ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!<br>
        ì „í™”ë²ˆí˜¸ ì¶”ì²¨ì„ í†µí•´ <b>ê¸°í”„í‹°ì½˜</b>ì„ ë³´ë‚´ë“œë¦´ ì˜ˆì •ì…ë‹ˆë‹¤.<br><br>

<!--        <span style="color: #a0522d; font-weight: bold;">-->
<!--          âš ï¸ ë³¸ í€´ì¦ˆëŠ” ì‹¤ì œ ì‚¬ë¡€ë¥¼ ê¸°ë°˜ìœ¼ë¡œ êµ¬ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.-->
<!--        </span><br>-->
<!--        - ë²”ì£„ì ì •ë³´ëŠ” FBI ê³µê°œ ìë£Œë¥¼ ë°”íƒ•ìœ¼ë¡œ í•˜ì˜€ìœ¼ë©°,<br>-->
<!--        - ë¹„ë²”ì£„ìëŠ” ëˆ„ëª…ì„ ì“°ê±°ë‚˜ ì˜ëª» ì§€ëª©ë˜ì—ˆë˜ ì‹¤ì œ ì¸ë¬¼ë“¤ì˜ ì •ë³´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•©ë‹ˆë‹¤.<br><br>-->

<!--        ìš°ë¦¬ëŠ” ë¬´ì—‡ì„ ë³´ê³  íŒë‹¨í•˜ê²Œ ë ê¹Œìš”? í•¨ê»˜ ì¶”ë¦¬í•´ë´…ì‹œë‹¤!ğŸ”<br><br>-->

        <span style="font-size: 0.9em; color: #555;">
        â€» ì…ë ¥í•˜ì‹  ì •ë³´ëŠ” AI í¸í–¥ íƒìƒ‰ í™œë™ì˜ í†µê³„ ë¶„ì„ ë° ì°¸ì—¬ í™•ì¸ì„ ìœ„í•œ ìš©ë„ë¡œë§Œ ì‚¬ìš©ë˜ë©°,<br>
        ëª¨ë“  ë°ì´í„°ëŠ” ìµëª… ì²˜ë¦¬ë˜ì–´ ì™¸ë¶€ì— ê³µê°œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.<br>
        <b>â€» ìµëª…ì„ ì›í•˜ì‹œë©´ ì´ë¦„ê³¼ ì „í™”ë²ˆí˜¸ ì¹¸ì— ì•„ë¬´ê²ƒë„ ì…ë ¥í•˜ì§€ ì•Šê³  ë‹¤ìŒì„ ëˆ„ë¥´ì„¸ìš”.</b>
        </span><br><br><br>
      </p>

      <div class="form-row">
        <label for="username">ì´ë¦„ï¼š</label>
        <input type="text" id="username" required class="underline-input">
      </div>

      <!-- ì„±ë³„ ì„ íƒ -->
    <div class="form-row">
      <label>ì„±ë³„ï¼š</label>
      <div class="gender-options">
        <label class="radio-label">
          <input type="radio" name="gender" value="ë‚¨ì„±">
          <span>ë‚¨ì„±</span>
        </label>
        <label class="radio-label">
          <input type="radio" name="gender" value="ì—¬ì„±">
          <span>ì—¬ì„±</span>
        </label>
      </div>
    </div>

    <!-- ë‚˜ì´ëŒ€ ì„ íƒ -->
    <div class="form-row">
      <label for="age">ë‚˜ì´ëŒ€ï¼š</label>
      <select id="age" required>
        <option value="">ì„ íƒí•´ì£¼ì„¸ìš”</option>
        <option value="10ëŒ€">10ëŒ€</option>
        <option value="20ëŒ€">20ëŒ€</option>
        <option value="30ëŒ€">30ëŒ€</option>
        <option value="40ëŒ€">40ëŒ€</option>
        <option value="50ëŒ€">50ëŒ€</option>
        <option value="60ëŒ€ ì´ìƒ">60ëŒ€ ì´ìƒ</option>
      </select>
    </div>


      <div class="form-row">
        <label for="phone1">ì „í™”ë²ˆí˜¸ï¼š</label>
        <div class="phone-wrapper">
          <input type="text" id="phone1" minlength = "3" maxlength="3" class="phone-part" pattern="[0-9]*" inputmode="numeric">
          <span>-</span>
          <input type="text" id="phone2" minlength = "3" maxlength="4" class="phone-part" pattern="[0-9]*" inputmode="numeric">
          <span>-</span>
          <input type="text" id="phone3" minlength = "3" maxlength="4" class="phone-part" pattern="[0-9]*" inputmode="numeric">
        </div>
      </div>

      <button class="btn" onclick="startQuiz()">ì‹œí—˜ ì‹œì‘</button>
    </div>

    <!-- í€´ì¦ˆ ì˜ì—­ -->
    <div id="quiz-container" style="display:none;"></div>

    <!-- overlay  -->
    <div id="overlay" style="display:none;"></div>

    <!-- í€´ì¦ˆ ì•ˆë‚´ ì˜¤ë²„ë ˆì´ -->
    <div id="instruction-overlay" style="display: none;">
      <div class="instruction-content">
        <img src="info/instruction.jpg" alt="í€´ì¦ˆ ì•ˆë‚´ ì´ë¯¸ì§€" class="instruction-image" />
        <button class="btn" onclick="closeInstruction()">ì´í•´í–ˆìŠµë‹ˆë‹¤!</button>
      </div>
    </div>

    <!-- ì •ë‹µ ì—¬ë¶€ íŒì—… -->
    <div id="popup"></div>

    <!-- ì†Œê°ë¬¸ ì‘ì„± ì˜ì—­ -->

    <div id="final-form" style="display: none;">
      <p style="text-align: center; font-size: 18px; font-weight: bold; margin-top: 24px; color: #7b4b1c;">
        -
      </p>
      <textarea id="feedback" placeholder="ìë„¤ëŠ” ì–´ë–¤ ê¸°ì¤€ìœ¼ë¡œ ë²”ì¸ì„ ì¶”ë¦¬í–ˆëŠ”ê°€?
ë§ì„¤ì˜€ë˜ ìˆœê°„ì´ë‚˜, ì°œì°œí–ˆë˜ íŒë‹¨ë„ ì¢‹ë„¤. ëŠë‚€ ë°”ë¥¼ ììœ ë¡­ê²Œ ë‚¨ê²¨ì£¼ê²Œë‚˜."></textarea><br>
      <div style="text-align: center;">
        <button class="btn" onclick="submitFeedback()">ìê²© ì‹œí—˜ ì¢…ë£Œ</button>
      </div>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script src="quiz_data.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCgtY7J_DbPq5jf7Z1mzoa7DjZy7sZXZRO",
      authDomain: "ethicode-quiz.firebaseapp.com",
      projectId: "ethicode-quiz",
      storageBucket: "ethicode-quiz.appspot.com",
      messagingSenderId: "957429525105",
      appId: "1:957429525105:web:671f4094e8aec54c9889d0",
      measurementId: "G-J7Q6S0JPH2"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    let username = '';
    let phone = '';
    let gender = '';
    let age = '';

    let currentQuestion = 0; // í˜„ì¬ ë¬¸ì œ ë²ˆí˜¸
    let score = 0; // ì ìˆ˜
    let userAnswers = []; // ì •ë‹µ OX ì—¬ë¶€ ë°°ì—´


    // ì‚¬ìš©ì ì •ë³´ë¥¼ ì…ë ¥ë°›ê³  í€´ì¦ˆ ì‹œì‘
    function startQuiz() {

      username = document.getElementById("username").value.trim();
      const phone1 = document.getElementById("phone1").value.trim();
      const phone2 = document.getElementById("phone2").value.trim();
      const phone3 = document.getElementById("phone3").value.trim();
      phone = `${phone1}-${phone2}-${phone3}`;

      gender = document.querySelector('input[name="gender"]:checked')?.value;
      age = document.getElementById("age").value;

      // ì´ë¦„/ì „í™”ë²ˆí˜¸ ì˜ˆì™¸ ì²˜ë¦¬
      if (!username || username === '') {
        username = 'ìµëª…';
      }

      if (phone1 === '' || phone2 === '' || phone3 === '') {
        phone = '010-0000-0000';
      } else {
        phone = `${phone1}-${phone2}-${phone3}`;
      }

      // ì„±ë³„/ë‚˜ì´ëŒ€ëŠ” ì—¬ì „íˆ í•„ìˆ˜
      if (!gender || !age) {
        alert("ì„±ë³„ê³¼ ë‚˜ì´ëŒ€ëŠ” ë°˜ë“œì‹œ ì„ íƒí•´ì£¼ì„¸ìš”.");
        return;
      }

      document.querySelector('header .icon').style.display = 'none';
      document.querySelector('header h1').innerHTML = 'ê³¼ì—° ì‚¬ì§„ ì†ì˜ ì¸ë¬¼ì€ <span class="highlight">ë²”ì£„ì</span>ì¼ê¹Œìš”?';

      // ì‚¬ìš©ì ì •ë³´ ì €ì¥ë§Œ í•´ë‘ê³  í€´ì¦ˆëŠ” ì•„ì§ ì‹œì‘í•˜ì§€ ì•ŠìŒ
      document.getElementById("user-form").style.display = "none";
      document.getElementById("instruction-overlay").style.display = "flex";
    }

    function closeInstruction() {
      document.querySelector('header .icon').style.display = 'none';
      document.querySelector('header h1').innerHTML = 'ê³¼ì—° ì‚¬ì§„ ì†ì˜ ì¸ë¬¼ì€ <span class="highlight">ë²”ì£„ì</span>ì¼ê¹Œìš”?';

      document.getElementById("instruction-overlay").style.display = "none";
      document.getElementById("quiz-container").style.display = "block";
      loadQuestion(); // í€´ì¦ˆ ì‹œì‘
    }

    function loadQuestion() {
      const quizContainer = document.getElementById("quiz-container");

      if (currentQuestion < quizData.length) {
        const q = quizData[currentQuestion];

        // ì´ë¯¸ì§€ ë¯¸ë¦¬ ë¡œë”©
        const img = new Image();
        img.src = q.img;
        quizContainer.style.opacity = 0; // ë¨¼ì € íˆ¬ëª…í•˜ê²Œ ì„¤ì •

        img.onload = () => {
          quizContainer.innerHTML = `
            <div class="quiz-flex-box">
              <div class="left-side">
                <div class="photo-frame">
                  <img src="${q.img}" alt="ë¬¸ì œ ì´ë¯¸ì§€" class="profile-img" />
                </div>
              </div>

              <div class="right-side">
                <div class="profile-info">
                  <p><strong>ì´ë¦„ï¼š</strong> ${q.name}<br>
                  <strong>ì¶œìƒì—°ë„ï¼š</strong> ${q.birth}<br>
                  <strong>êµ­ì ï¼š</strong> ${q.origin}<br>
                  <strong>í‚¤ / ëª¸ë¬´ê²Œï¼š</strong> ${q.heightWeight}<br>
                  <strong>ì¸ì¢…ï¼š</strong> ${q.race}</p>
                </div>

                <div class="buttons">
                  <button onclick="checkAnswer('O')">O</button>
                  <button onclick="checkAnswer('X')">X</button>
                </div>
              </div>

            </div>

            <div class="question-progress">${currentQuestion + 1} / ${quizData.length}</div>
          `;
          // ë¶€ë“œëŸ½ê²Œ ë³´ì´ê²Œ í•˜ê¸°
          setTimeout(() => {
            quizContainer.style.opacity = 1;
          }, 50);
        };
      }
      else {
        document.querySelector('header h1').innerHTML = 'íƒì • ìê²© ì‹œí—˜ ì¢…ë£Œ!';

        let resultMessage = '';
        if (score >= 12) {
          resultMessage = 'í›Œë¥­í•´. ìë„¤ë¼ë©´ ê¸ˆë°©ì´ë¼ë„ ì‹¤ì „ì— íˆ¬ì…í•  ìˆ˜ ìˆê² êµ°.  ê·¸ë˜ë„ ì •ë³´ ìˆ˜ì²©ì€ í•œ ë²ˆì¯¤ í›‘ì–´ë³´ê²Œ.';
        } else if (score >= 6) {
          resultMessage = 'ê¸°ë³¸ê¸°ëŠ” ê°–ì·„ì§€ë§Œ, ì•„ì§ ê°ì´ ë¶€ì¡±í•˜êµ°.  ì •ë³´ ìˆ˜ì²©ìœ¼ë¡œ ë³µìŠµí•˜ë©° ì‹¤ë ¥ì„ ë‹¤ì ¸ë³´ê²Œ.';
        } else {
          resultMessage = 'ì¶”ë¦¬ì— ì•ì„œ ë…¸ë ¥ì´ í•„ìš”í•˜ê² ëŠ” ê±¸...  ì •ë³´ ìˆ˜ì²©ë¶€í„° ë‹¤ì‹œ í¼ì³ë³´ê²Œë‚˜.';
      }

quizContainer.innerHTML = `
    <p class="intro">ë‹¹ì‹ ì˜ ì¶”ë¦¬ëŠ”...</p>
    <h2 style="color: #a94442; font-size: 2.5em; margin-top: 4px;">${score}ì </h2>

    <div class="advisor-box">
      <div class="advisor-label">ğŸ•µï¸ ì„ ë°° íƒì •ì˜ ë©”ëª¨ ğŸ“ï¸</div>
      <div class="advisor-message">${resultMessage}</div>
    </div>

    <div class="purpose-box">
      <div class="purpose-label">ì´ ì²´í—˜ì˜ ëª©ì ì€?</div>
      <div class="purpose-message">
        <strong>ì œí•œëœ, í¸í–¥ëœ ì •ë³´ì— ì˜ì¡´í•œ íŒë‹¨ì´ ì–¼ë§ˆë‚˜ ì‰½ê²Œ í‹€ë¦´ ìˆ˜ ìˆëŠ”ì§€</strong> ì§ì ‘ ëŠê»´ë³´ê¸° ìœ„í•œ ì„¤ë¬¸ì…ë‹ˆë‹¤.<br><br>
        ì´ë¥¼ í†µí•´, <strong>â‘  ì‚¬ëŒì˜ í¸í–¥ì´ ë‹´ê¸´ ë°ì´í„°ëŠ” ì™„ë²½í•  ìˆ˜ ì—†ê³ </strong>,<br>
        <strong>â‘¡ ê·¸ ë°ì´í„°ë¥¼ í•™ìŠµí•œ AI ì—­ì‹œ í¸í–¥ë  ìˆ˜ ìˆë‹¤</strong>ëŠ” ì ì„ ì•Œë¦¬ê³ ì í•˜ì˜€ìŠµë‹ˆë‹¤.<br><br>
        ì´ëŸ¬í•œ í¸í–¥ëœ AIëŠ” ì‹¤ì œë¡œ <strong style="color: #a0522d;">ì¸ê¶Œì„ ì¹¨í•´</strong>í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
        ê·¸ êµ¬ì²´ì ì¸ ì‚¬ë¡€ê°€ ê¶ê¸ˆí•˜ë‹¤ë©´, ì•„ë˜ ë²„íŠ¼ì„ í†µí•´ ì œì¶œ í›„ <strong>â€˜ì •ë³´ ìˆ˜ì²©â€™</strong>ì„ í™•ì¸í•´ë³´ì„¸ìš”!
      </div.
    </div>
`;

document.getElementById("final-form").style.display = "block";
        document.getElementById("final-form").style.display = "block";
      }
    }

    function checkAnswer(userAnswer) {
      const correctAnswer = quizData[currentQuestion].answer;
      const isCorrect = userAnswer === correctAnswer;
      if (isCorrect) score++;

      userAnswers.push(isCorrect ? 1 : 0);  // 1ì´ë©´ ì •ë‹µ, 0ì´ë©´ ì˜¤ë‹µ

      showPopup(isCorrect);
    }

    // íŒì—…ì„ í‘œì‹œí•˜ëŠ” í•¨ìˆ˜
    function showPopup(isCorrect) {
      const popup = document.getElementById("popup");
      const overlay = document.getElementById("overlay");
      const quizContainer = document.getElementById("quiz-container");
      const currentData = quizData[currentQuestion];

      // ì •ë‹µ ì—¬ë¶€ ê¸°ë³¸ ë©”ì‹œì§€
      let popupMessage = `
      ${isCorrect ? "âœ… ì •ë‹µì…ë‹ˆë‹¤!" : "âŒ ì˜¤ë‹µì…ë‹ˆë‹¤!"}
      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      ${currentData.answer === "O" && currentData.crime !== "ì—†ìŒ"
        ? `ğŸš¨ï¸ ë²”ì£„ ë‚´ìš©ï¼š ${currentData.crime}`
        : "ğŸ³ï¸ ì´ ì¸ë¬¼ì€ ë²”ì£„ìê°€ ì•„ë‹™ë‹ˆë‹¤."}

      `;

      // íŒì—… ë° ë°°ê²½ í‘œì‹œ
      popup.innerText = popupMessage;
      popup.style.display = "block";
      popup.style.opacity = 1;
      overlay.style.display = "block";

      // í…ŒìŠ¤íŠ¸ìš© íŒì—… ìƒëµ
      <!--popup.style.opacity = 0;-->
      <!--popup.style.display = "none";-->
      <!--overlay.style.display = "none";-->
      <!--currentQuestion++;-->
      <!--loadQuestion();-->

      // 1.5ì´ˆ í›„ ìë™ìœ¼ë¡œ íŒì—… ìˆ¨ê¸°ê¸°
      setTimeout(() => {
        popup.style.opacity = 0;
        setTimeout(() => {
          popup.style.display = "none";
          overlay.style.display = "none";
          currentQuestion++;
          loadQuestion();   // ë‹¤ìŒ ë¬¸ì œë¡œ ì´ë™
        }, 200);
      }, 1300);
    }

    function submitFeedback() {
      const feedback = document.getElementById("feedback").value;

      if (feedback.trim() === "") {
        alert("ì†Œê°ë¬¸ì„ ì‘ì„±í•´ì£¼ì„¸ìš”.");
        return;
      }

      db.collection("responses").add({
        username,
        gender,
        age,
        phone,
        score,
        answers: userAnswers,
        feedback,
        timestamp: new Date()
      })
      .then(() => {
        console.log("Firebase ì €ì¥ ì„±ê³µ!");

      const popup = document.getElementById("popup");
      const overlay = document.getElementById("overlay");

        popup.innerText = "ì •ë³´ ìˆ˜ì²© ì—´ëŒ ì¤‘... ğŸ•µï¸â€â™‚ï¸";
        popup.style.display = "block";
        popup.style.opacity = 1;

        overlay.style.display = "block";
        overlay.style.opacity = 1;

        // 2ì´ˆ í›„ information.htmlë¡œ ì´ë™
        setTimeout(() => {
          popup.style.opacity = 0;
          setTimeout(() => {
            popup.style.display = "none";
            overlay.style.display = "none";
            window.location.href = "information.html";
          }, 200); // fade-out ì‹œê°„
        }, 3000);
      })
      .catch((error) => {
        console.error("Firebase ì €ì¥ ì‹¤íŒ¨:", error);
        alert("ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
      });
    }

    // í•¨ìˆ˜ë“¤ ë‹¤ ëë‚œ ë’¤
    document.querySelectorAll('.phone-part').forEach((input, index, inputs) => {
      input.addEventListener('input', () => {
       // ìˆ«ì ì´ì™¸ ì…ë ¥ ë¶ˆê°€ëŠ¥í•˜ê²Œ ì„¤ì •
      input.value = input.value.replace(/\D/g, '');

        if (input.value.length === input.maxLength && index < inputs.length - 1) {
          inputs[index + 1].focus();
        }
      });
    });
  </script>
</body>
</html>
