<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Ethicode | OX í€´ì¦ˆ 15ë¬¸ì œ</title>
  <link rel="stylesheet" href="quiz_style.css" />
</head>
<body>
  <div class="container">
    <header>
      <img src="detective-icon.png" alt="íƒì • ì•„ì´ì½˜" class="icon">
      <h1><span class="highlight">Ethicode</span> íƒì •ë‹˜ì˜ ì´ë¦„ì€...</h1>
    </header>

    <!-- ì‚¬ìš©ì ì •ë³´ ì…ë ¥ í¼ -->
    <div id="user-form" class="form-container">
      <p class="intro">
        í€´ì¦ˆë¥¼ ì‹œì‘í•˜ê¸° ì „ì— ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!<br>
        ì „í™”ë²ˆí˜¸ ì¶”ì²¨ì„ í†µí•´ ê¸°í”„í‹°ì½˜ ë³´ë‚´ë“œë¦¬ê² ìŠµë‹ˆë‹¤.<br>
        ë§ì€ ì°¸ì—¬ ë¶€íƒë“œë¦´ê²Œìš”..â™¡
      </p>

      <div class="form-row">
        <label for="username">ì´ë¦„ï¼š</label>
        <input type="text" id="username" required class="underline-input">
      </div>


      <div class="form-row">
        <label for="phone1">ì „í™”ë²ˆí˜¸ï¼š</label>
        <div class="phone-wrapper">
          <input type="text" id="phone1" minlength = "3" maxlength="3" class="phone-part" pattern="[0-9]*" inputmode="numeric">
          <span>-</span>
          <input type="text" id="phone2" minlength = "3" maxlength="4" class="phone-part" pattern="[0-9]*" inputmode="numeric">
          <span>-</span>
          <input type="text" id="phone3" minlength = "3" maxlength="4" class="phone-part" pattern="[0-9]*" inputmode="numeric">
        </div>
      </div>

      <button class="btn" onclick="startQuiz()">í€´ì¦ˆ ì‹œì‘</button>
    </div>

    <!-- í€´ì¦ˆ ì˜ì—­ -->
    <div id="quiz-container" style="display:none;"></div>

    <!-- ì •ë‹µ ì—¬ë¶€ íŒì—… -->
    <div id="popup"></div>

    <!-- ì†Œê°ë¬¸ ì‘ì„± ì˜ì—­ -->
    <div id="final-form" style="display:none;">
      <h2>í€´ì¦ˆê°€ ëë‚¬ìŠµë‹ˆë‹¤! ì†Œê°ë¬¸ì„ ì‘ì„±í•´ì£¼ì„¸ìš”ï¼š</h2>
      <textarea id="feedback" placeholder="ì†Œê°ì„ ì ì–´ì£¼ì„¸ìš”..."></textarea><br>
      <button class="btn" onclick="submitFeedback()">ì†Œê° ì œì¶œ</button>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script src="quiz_data.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCgtY7J_DbPq5jf7Z1mzoa7DjZy7sZXZRO",
      authDomain: "ethicode-quiz.firebaseapp.com",
      projectId: "ethicode-quiz",
      storageBucket: "ethicode-quiz.appspot.com",
      messagingSenderId: "957429525105",
      appId: "1:957429525105:web:671f4094e8aec54c9889d0",
      measurementId: "G-J7Q6S0JPH2"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    let username = '';
    let phone = '';
    let gender = '';
    let age = '';

    let currentQuestion = 0; // í˜„ì¬ ë¬¸ì œ ë²ˆí˜¸
    let score = 0; // ì ìˆ˜


    // ì‚¬ìš©ì ì •ë³´ë¥¼ ì…ë ¥ë°›ê³  í€´ì¦ˆ ì‹œì‘
    function startQuiz() {

      username = document.getElementById("username").value.trim();
      const phone1 = document.getElementById("phone1").value.trim();
      const phone2 = document.getElementById("phone2").value.trim();
      const phone3 = document.getElementById("phone3").value.trim();
      phone = `${phone1}-${phone2}-${phone3}`;

      //gender = document.querySelector('input[name="gender"]:checked')?.value;
      //age = document.getElementById("age").value;

      if (
        !username ||
        phone1.length < 3 ||
        phone2.length < 3 ||
        phone3.length < 4
      ) {
      alert("ëª¨ë“  í•­ëª©ì„ ì •í™•íˆ ì…ë ¥í•´ì£¼ì„¸ìš”.");
      return;
    }

      document.querySelector('header .icon').style.display = 'none';
      document.querySelector('header h1').innerHTML = 'ê³¼ì—° ì‚¬ì§„ ì†ì˜ ì¸ë¬¼ì€ <span class="highlight">ë²”ì¸</span>ì¼ê¹Œìš”?';

      // ì‚¬ìš©ì ì •ë³´ ì…ë ¥ í¼ ìˆ¨ê¸°ê¸°
      document.getElementById("user-form").style.display = "none";

      // í€´ì¦ˆ í™”ë©´ ë³´ì´ê¸°
      document.getElementById("quiz-container").style.display = "block";

      // ì²« ë²ˆì§¸ ë¬¸ì œ ë¡œë“œ
      loadQuestion();
    }

    function loadQuestion() {
      const quizContainer = document.getElementById("quiz-container");

      if (currentQuestion < quizData.length) {
        const q = quizData[currentQuestion];

        // ì´ë¯¸ì§€ ë¯¸ë¦¬ ë¡œë”©
        const img = new Image();
        img.src = q.img;
        quizContainer.style.opacity = 0; // ë¨¼ì € íˆ¬ëª…í•˜ê²Œ ì„¤ì •

        img.onload = () => {
          quizContainer.innerHTML = `
            <div class="quiz-flex-box">
              <div class="left-side">
                <img src="${q.img}" alt="ë¬¸ì œ ì´ë¯¸ì§€" class="profile-img" />
              </div>

              <div class="right-side">
                <div class="profile-info">
                  <p><strong>ì´ë¦„:</strong> ${q.name}</p>
                  <p><strong>ìƒë…„ì›”ì¼/ë‚˜ì´ï¼š</strong> ${q.birth} / ${q.age}</p>
                  <p><strong>ì¶œìƒì§€ / êµ­ì ï¼š</strong> ${q.origin}</p>
                  <p><strong>í‚¤ / ëª¸ë¬´ê²Œï¼š</strong> ${q.heightWeight}</p>
                  <p><strong>ì¸ì¢…ï¼š</strong> ${q.race}</p>
                </div>

                <div class="buttons">
                  <button onclick="checkAnswer('O')">O</button>
                  <button onclick="checkAnswer('X')">X</button>
                </div>
              </div>

            </div>
          `;
          // ë¶€ë“œëŸ½ê²Œ ë³´ì´ê²Œ í•˜ê¸°
          setTimeout(() => {
            quizContainer.style.opacity = 1;
          }, 50);
        };
      } else {
        let resultMessage = '';
      if (score >= 12) {
        resultMessage = 'í›—, ìš°ìˆ˜í•œ íƒì •ì´êµ°. ê·¸ë˜ë„ ì •ë³´ ìˆ˜ì²©ìœ¼ í•œë²ˆ í™•ì¸í•´ë´.';
      } else if (score >= 6) {
        resultMessage = 'ì¡°ê¸ˆë§Œ ë” ë…¸ë ¥í•˜ë©´, ìš°ìˆ˜í•œ íƒì •ì´ ë  ìˆ˜ ìˆê² ëŠ” ê±¸? ì •ë³´ ìˆ˜ì²©ì„ í•œ ë²ˆ ì½ì–´ë³´ê²Œë‚˜.';
      } else {
        resultMessage = 'íƒì •ì´ ë˜ê¸° ìœ„í•´ ë…¸ë ¥ì´ í•„ìš”í•˜ê² ëŠ” ê±¸... ì •ë³´ ìˆ˜ì²©ì„ ì½ì–´ë³´ê²Œë‚˜.';
      }

quizContainer.innerHTML = `
  <h2>í€´ì¦ˆ ì¢…ë£Œ! ë‹¹ì‹ ì˜ ì ìˆ˜ëŠ” ${score}ì ì…ë‹ˆë‹¤.</h2>
  <p class="result-message">${resultMessage}</p>
`;

document.getElementById("final-form").style.display = "block";
        document.getElementById("final-form").style.display = "block";
      }
    }

    function checkAnswer(userAnswer) {
      const correctAnswer = quizData[currentQuestion].answer;
      const isCorrect = userAnswer === correctAnswer;
      if (isCorrect) score++;
      showPopup(isCorrect);
    }

    // íŒì—…ì„ í‘œì‹œí•˜ëŠ” í•¨ìˆ˜
    function showPopup(isCorrect) {
      const popup = document.getElementById("popup");
      const quizContainer = document.getElementById("quiz-container");
      
      popup.innerText = isCorrect ? "ì •ë‹µì…ë‹ˆë‹¤!" : "í‹€ë ¸ìŠµë‹ˆë‹¤!";
      popup.style.display = "block";
      popup.style.opacity = 1;

      // 1.5ì´ˆ í›„ ìë™ìœ¼ë¡œ íŒì—… ìˆ¨ê¸°ê¸°
      setTimeout(() => {
        popup.style.opacity = 0;
        setTimeout(() => {
          popup.style.display = "none";
          currentQuestion++;
          loadQuestion();   // ë‹¤ìŒ ë¬¸ì œë¡œ ì´ë™
          setTimeout(() => {
          quizContainer.style.opacity = 1;
          }, 100);
        }, 500);
      }, 1500);
    }

    function submitFeedback() {
      const feedback = document.getElementById("feedback").value;
      if (feedback.trim() === "") {
        alert("ì†Œê°ë¬¸ì„ ì‘ì„±í•´ì£¼ì„¸ìš”.");
        return;
      }

      db.collection("responses").add({
        username,
        phone,
        score,
        feedback,
        timestamp: new Date()
      })
      .then(() => {
        console.log("Firebase ì €ì¥ ì„±ê³µ!");

      const popup = document.getElementById("popup");
        popup.innerText = "ì •ë³´ ìˆ˜ì²©ìœ¼ë¡œ ì´ë™ ì¤‘ ğŸ•µï¸â€â™‚ï¸";
        popup.style.display = "block";
        popup.style.opacity = 1;

        // 2ì´ˆ í›„ information.htmlë¡œ ì´ë™
        setTimeout(() => {
          popup.style.opacity = 0;
          setTimeout(() => {
            popup.style.display = "none";
            window.location.href = "information.html";
          }, 500); // fade-out ì‹œê°„
        }, 3000);
      })
      .catch((error) => {
        console.error("Firebase ì €ì¥ ì‹¤íŒ¨:", error);
        alert("ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
      });
    }

    // í•¨ìˆ˜ë“¤ ë‹¤ ëë‚œ ë’¤
    document.querySelectorAll('.phone-part').forEach((input, index, inputs) => {
      input.addEventListener('input', () => {
       // ìˆ«ì ì´ì™¸ ì…ë ¥ ë¶ˆê°€ëŠ¥í•˜ê²Œ ì„¤ì •
      input.value = input.value.replace(/\D/g, '');

        if (input.value.length === input.maxLength && index < inputs.length - 1) {
          inputs[index + 1].focus();
        }
      });
    });
  </script>
</body>
</html>
